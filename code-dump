
<!-- para dun sa cards -->
<?php
// Connect to the database
$host = 'localhost';
$user = 'username';
$password = 'password';
$database = 'database_name';

$mysqli = new mysqli($host, $user, $password, $database);

// Check connection
if ($mysqli->connect_error) {
    die("Connection failed: " . $mysqli->connect_error);
}

// Fetch data from the database
$sql = "SELECT * FROM exercises";
$result = $mysqli->query($sql);
?>

<!-- Display the data in Bootstrap cards -->
<div class="container">
  <div class="row">
    <?php while($row = $result->fetch_assoc()) { ?>
      <div class="col-sm-12 col-md-6 col-lg-4 mb-4">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title"><?php echo $row['exercise_name']; ?></h5>
            <p class="card-text"><?php echo $row['exercise_description']; ?></p>
            <a href="#" class="btn btn-primary">Learn More</a>
          </div>
        </div>
      </div>
    <?php } ?>
  </div>
</div>

<?php
// Close the connection
$mysqli->close();
?>





<div class="modal fade" id="routinemodal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Create Routine</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
      <form id="routine-name-form" name="routine-name-form" method="POST" action="../db/functions.php">
        <input type="text" class="form-control" placeholder="Enter Routine name" id="routinenamefield" name="routinenamefield">
      
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancel</button>
        <button type="submit" class="btn btn-success" id="insertroutine" name="insertroutine">Submit</button>
      </div>
      </form>
    </div>
  </div>
</div>




if (isset($_POST['insertroutine'])) {

$routinenamevalue = $_POST['routinenamefield'];
$user_id = $_SESSION['user_id'];

$sql = "INSERT INTO tbl_routines (user_id, routine_name) VALUES ('$user_id','$routinenamevalue')";
$result = mysqli_query($conn, $sql);

if(mysqli_affected_rows($conn) > 0) {
  echo "Routine Successfully created";
} else {
  echo "Data not inserted";
}
}



$(document).ready(function() {
$('#insertroutine').click(function() {
  // Get the form data
  var formData = $('#routine-name-form').serialize();
  // Send the form data to the PHP script using AJAX
  $.ajax({
    url: '../db/functions.php',
    type: 'POST',
    data: formData,
    success: function(response) {
      // Handle the response from the PHP script
      alert("Data inserted successfully");
    },
    error: function(xhr, status, error) {
      // Handle errors
      alert("Data insertion failed");
    }
    });
  });
});


<div class="card-container">
    <?php while($row = $result->fetch_assoc()) { ?>
    <div class="card">
        <img src="<?php echo $row['exercise_image']; ?>" class="card-img-top" alt="Exercise Image">
        <div class="card-body">
            <h5 class="card-title"><?php echo $row['exercise_name']; ?></h5>
            <p class="card-text"><?php echo $row['exercise_description']; ?></p>
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addExerciseModal" data-exercise-id="<?php echo $row['exercise_id']; ?>">Add to Routine</button>
        </div>
    </div>
    <?php } ?>
</div>

<div class="modal fade" id="addExerciseModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Add Exercise to Routine</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="addExerciseForm">
                    <input type="hidden" name="exercise_id" id="exercise_id">
                    <div class="form-group">
                        <label for="routine_id">Select Routine:</label>
                        <select class="form-control" id="routine_id" name="routine_id">
                            <?php
                            // Fetch all routines of the current user
                            $query = "SELECT * FROM tbl_routines WHERE user_id = $_SESSION[user_id]";
                            $result = mysqli_query($conn, $query);
                            while ($row = mysqli_fetch_assoc($result)) {
                                echo '<option value="' . $row['routine_id'] . '">' . $row['routine_name'] . '</option>';
                            }
                            ?>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="addExerciseBtn">Add</button>
            </div>
        </div>
    </div>
</div>

<script>
$(document).ready(function() {
    // When the Add to Routine button is clicked, set the exercise ID in the form and show the modal
    $('.card .btn-primary').click(function() {
        var exerciseId = $(this).data('exercise-id');
        $('#exercise_id').val(exerciseId);
        $('#addExerciseModal').modal('show');
    });

    // When the Add button is clicked in the modal, submit the form via AJAX
    $('#addExerciseBtn').click(function() {
        var formData = $('#addExerciseForm').serialize();
        $.ajax({
            url: '../db/functions.php', // replace with your PHP script
            type: 'POST',
            data: formData,
            success: function(response) {
                // handle success
                console.log(response);
                $('#addExerciseModal').modal('hide'); // hide the modal
            },
            error: function(xhr, status, error) {
                // handle error
                console.log(error);
            }
        });
    });
});
</script>
